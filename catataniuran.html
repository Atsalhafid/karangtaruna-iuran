<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Karang Taruna Kuti Berseri</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-green-600 text-white p-4 flex justify-between items-center shadow-md">
    <h1 class="text-lg font-bold">
      <span class="inline-flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5V4H2v16h5"/>
        </svg>
        Karang Taruna Kuti Berseri
      </span>
      <p class="text-sm font-normal">Sistem Catatan Iuran Bulanan</p>
    </h1>
    <div class="bg-white text-green-600 px-3 py-1 rounded shadow font-semibold">
      Saldo: Rp <span id="saldo">0</span>
    </div>
  </header>

  <!-- Info Box -->
  <div class="grid grid-cols-2 gap-3 p-4">
    <div class="bg-white p-4 rounded shadow text-blue-600 text-center">
      <p class="font-bold">Total Pemasukan</p>
      <p class="text-xl">Rp <span id="totalPemasukan">0</span></p>
    </div>
    <div class="bg-white p-4 rounded shadow text-red-600 text-center">
      <p class="font-bold">Total Pengeluaran</p>
      <p class="text-xl">Rp <span id="totalPengeluaran">0</span></p>
    </div>
  </div>

  <!-- Tombol -->
  <div class="flex flex-wrap justify-center gap-2 p-4">
    <button onclick="tambahAnggota()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded shadow">+ Tambah Anggota</button>
    <button onclick="tambahIuran()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded shadow">+ Tambah Iuran</button>
    <button onclick="tambahPengeluaran()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded shadow">+ Tambah Pengeluaran</button>
  </div>

  <!-- Daftar Anggota -->
  <div class="p-4">
    <div class="bg-white p-4 rounded shadow">
      <h2 class="font-bold mb-2">Daftar Anggota</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-2 border">No</th>
              <th class="p-2 border">Nama</th>
              <th class="p-2 border">Iuran Bulan Ini</th>
              <th class="p-2 border">Status</th>
              <th class="p-2 border">Aksi</th>
            </tr>
          </thead>
          <tbody id="anggotaTable">
            <tr><td colspan="5" class="text-center p-2">Belum ada data anggota</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Riwayat Transaksi -->
  <div class="p-4">
    <div class="bg-white p-4 rounded shadow">
      <h2 class="font-bold mb-2">Riwayat Transaksi</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm border">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-2 border">Tanggal</th>
              <th class="p-2 border">Keterangan</th>
              <th class="p-2 border">Jenis</th>
              <th class="p-2 border">Nominal</th>
              <th class="p-2 border">Aksi</th>
            </tr>
          </thead>
          <tbody id="transaksiTable">
            <tr><td colspan="5" class="text-center p-2">Belum ada transaksi</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
let anggota = JSON.parse(localStorage.getItem('anggota')) || [];
let transaksi = JSON.parse(localStorage.getItem('transaksi')) || [];

function saveData() {
  localStorage.setItem('anggota', JSON.stringify(anggota));
  localStorage.setItem('transaksi', JSON.stringify(transaksi));
  render();
}

function formatRupiah(angka) {
  return new Intl.NumberFormat('id-ID').format(angka);
}

function getDateNow() {
  let d = new Date();
  let options = { day: '2-digit', month: 'long', year: 'numeric' };
  return d.toLocaleDateString('id-ID', options);
}

// Tambah Anggota
function tambahAnggota() {
  Swal.fire({
    title: 'Tambah Anggota',
    input: 'text',
    inputLabel: 'Nama Anggota',
    showCancelButton: true,
    confirmButtonText: 'Tambah',
    inputValidator: (value) => {
      if (!value) return 'Nama tidak boleh kosong!';
    }
  }).then((result) => {
    if (result.isConfirmed) {
      anggota.push({ nama: result.value, iuran: 0, status: "Belum Bayar" });
      saveData();
      Swal.fire('Berhasil!', 'Anggota ditambahkan', 'success');
    }
  });
}

// Tambah Iuran
function tambahIuran() {
  if (anggota.length === 0) {
    Swal.fire('Oops', 'Tambah anggota dulu!', 'warning');
    return;
  }
  let options = anggota.map((a, i) => `<option value="${i}">${a.nama}</option>`).join('');
  Swal.fire({
    title: 'Tambah Iuran',
    html: `<select id="anggotaSelect" class="swal2-input">${options}</select>
           <input id="nominalIuran" class="swal2-input" placeholder="Nominal" type="number">`,
    focusConfirm: false,
    showCancelButton: true,
    preConfirm: () => {
      let idx = document.getElementById('anggotaSelect').value;
      let nominal = document.getElementById('nominalIuran').value;
      if (!nominal || nominal <= 0) {
        Swal.showValidationMessage('Nominal harus diisi!');
      }
      return { idx, nominal };
    }
  }).then((result) => {
    if (result.isConfirmed) {
      let { idx, nominal } = result.value;
      anggota[idx].iuran += parseInt(nominal);
      anggota[idx].status = "Lunas";
      transaksi.push({
        tanggal: getDateNow(),
        keterangan: `Iuran ${anggota[idx].nama}`,
        jenis: "Pemasukan",
        nominal: parseInt(nominal)
      });
      saveData();
      Swal.fire('Berhasil!', 'Iuran ditambahkan', 'success');
    }
  });
}

// Tambah Pengeluaran
function tambahPengeluaran() {
  Swal.fire({
    title: 'Tambah Pengeluaran',
    html: `<input id="ketPengeluaran" class="swal2-input" placeholder="Keterangan">
           <input id="nominalPengeluaran" class="swal2-input" type="number" placeholder="Nominal">`,
    showCancelButton: true,
    preConfirm: () => {
      let ket = document.getElementById('ketPengeluaran').value;
      let nominal = document.getElementById('nominalPengeluaran').value;
      if (!ket || !nominal || nominal <= 0) {
        Swal.showValidationMessage('Isi keterangan & nominal!');
      }
      return { ket, nominal };
    }
  }).then((result) => {
    if (result.isConfirmed) {
      let { ket, nominal } = result.value;
      transaksi.push({
        tanggal: getDateNow(),
        keterangan: ket,
        jenis: "Pengeluaran",
        nominal: parseInt(nominal)
      });
      saveData();
      Swal.fire('Berhasil!', 'Pengeluaran ditambahkan', 'success');
    }
  });
}

// Hapus Anggota
function hapusAnggota(index) {
  Swal.fire({
    title: 'Yakin?',
    text: "Data anggota akan dihapus!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ya, hapus!'
  }).then((res) => {
    if (res.isConfirmed) {
      anggota.splice(index, 1);
      saveData();
      Swal.fire('Terhapus!', 'Anggota dihapus', 'success');
    }
  });
}

// Hapus Transaksi
function hapusTransaksi(index) {
  Swal.fire({
    title: 'Yakin?',
    text: "Transaksi ini akan dihapus!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonText: 'Ya, hapus!'
  }).then((res) => {
    if (res.isConfirmed) {
      transaksi.splice(index, 1);
      saveData();
      Swal.fire('Terhapus!', 'Transaksi dihapus', 'success');
    }
  });
}

function render() {
  let anggotaTable = document.getElementById('anggotaTable');
  let transaksiTable = document.getElementById('transaksiTable');
  anggotaTable.innerHTML = "";
  transaksiTable.innerHTML = "";

  if (anggota.length === 0) {
    anggotaTable.innerHTML = `<tr><td colspan="5" class="text-center p-2">Belum ada data anggota</td></tr>`;
  } else {
    anggota.forEach((a, i) => {
      anggotaTable.innerHTML += `
        <tr>
          <td class="border p-2">${i+1}</td>
          <td class="border p-2">${a.nama}</td>
          <td class="border p-2">Rp ${formatRupiah(a.iuran)}</td>
          <td class="border p-2">${a.status}</td>
          <td class="border p-2">
            <button onclick="hapusAnggota(${i})" class="text-red-500">Hapus</button>
          </td>
        </tr>`;
    });
  }

  if (transaksi.length === 0) {
    transaksiTable.innerHTML = `<tr><td colspan="5" class="text-center p-2">Belum ada transaksi</td></tr>`;
  } else {
    transaksi.forEach((t, i) => {
      transaksiTable.innerHTML += `
        <tr>
          <td class="border p-2">${t.tanggal}</td>
          <td class="border p-2">${t.keterangan}</td>
          <td class="border p-2">${t.jenis}</td>
          <td class="border p-2">Rp ${formatRupiah(t.nominal)}</td>
          <td class="border p-2">
            <button onclick="hapusTransaksi(${i})" class="text-red-500">Hapus</button>
          </td>
        </tr>`;
    });
  }

  // Hitung saldo
  let pemasukan = transaksi.filter(t => t.jenis === "Pemasukan").reduce((a, b) => a+b.nominal, 0);
  let pengeluaran = transaksi.filter(t => t.jenis === "Pengeluaran").reduce((a, b) => a+b.nominal, 0);
  document.getElementById('totalPemasukan').textContent = formatRupiah(pemasukan);
  document.getElementById('totalPengeluaran').textContent = formatRupiah(pengeluaran);
  document.getElementById('saldo').textContent = formatRupiah(pemasukan - pengeluaran);
}

render();
</script>
</body>
</html>